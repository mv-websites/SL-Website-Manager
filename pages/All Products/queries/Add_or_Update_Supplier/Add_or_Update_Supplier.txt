-- Insert/Update for the main product
INSERT INTO product_suppliers (id, supplier_id, product_id)
VALUES (
  {{ Table1.updatedRow.id }},
  {{ Table1.updatedRow.supplier }},
  {{ Table1.updatedRow.product_id }}
)
ON DUPLICATE KEY UPDATE
  supplier_id = {{Table1.updatedRow.supplier}};
	
-- Insert/Update for all child products of that product
INSERT INTO product_suppliers (supplier_id, product_id)
SELECT 
    {{ Table1.updatedRow.supplier }} AS supplier_id,
    ap.product_id
FROM all_products ap
WHERE ap.parent_id = {{ Table1.updatedRow.product_id }}
ON DUPLICATE KEY UPDATE
  supplier_id = VALUES(supplier_id);
